---
layout: post
title: Portable Drive encryption with Ubuntu
---

<div dir="ltr" style="text-align: left;" trbidi="on"><div style="text-align: justify;">I haven't used encryption on hard disk drives or pen drives ever. But recently I got a requirement to encrypt some portables disks. And there are some limitations also. After encrypting you would not be able to use that drive on Windows Operating System. You are going to limit to the ext4 file system as well.</div><div style="text-align: justify;"><br />First, you have to install cryptsetup to format your portable drive with encryption. To install cryptsetup run following command on a terminal.<br /><pre>sudo apt-get install cryptsetup</pre></div><div class="separator" style="clear: both; text-align: center;"><a href="http://3.bp.blogspot.com/-Ta2eJWnADfQ/UzRZW63X8CI/AAAAAAAAA8c/YIB4bbOMCWA/s1600/1.png" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="400" src="https://3.bp.blogspot.com/-Ta2eJWnADfQ/UzRZW63X8CI/AAAAAAAAA8c/YIB4bbOMCWA/s320/1.png" width="400" /></a></div><div style="text-align: justify;">After that, you have to open Disk utility application. To open it just search on Unity dashboard like below.</div><div class="separator" style="clear: both; text-align: center;">&nbsp;<a href="http://3.bp.blogspot.com/-l8nsI27mQOc/UzTeegjRmMI/AAAAAAAAA8o/EM-q3Z8b0qE/s1600/2.png" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="186" src="https://3.bp.blogspot.com/-l8nsI27mQOc/UzTeegjRmMI/AAAAAAAAA8o/EM-q3Z8b0qE/s1600/2.png" width="400" /></a></div><div class="separator" style="clear: both; text-align: center;"></div><div style="text-align: justify;">&nbsp;Then you will get a window like this.</div><div class="separator" style="clear: both; text-align: center;"><a href="http://3.bp.blogspot.com/-2Th40cHJUzw/UzTelTCK_JI/AAAAAAAAA80/fs1hdhh9qok/s1600/3.png" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="276" src="https://3.bp.blogspot.com/-2Th40cHJUzw/UzTelTCK_JI/AAAAAAAAA80/fs1hdhh9qok/s1600/3.png" width="400" /></a></div><div style="text-align: justify;">Click on "Unmount Volume"</div><div class="separator" style="clear: both; text-align: center;"><a href="http://2.bp.blogspot.com/-rut5NS-JCQg/UzTe7WMFZPI/AAAAAAAAA84/9zLh55i8mck/s1600/4.png" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="277" src="https://2.bp.blogspot.com/-rut5NS-JCQg/UzTe7WMFZPI/AAAAAAAAA84/9zLh55i8mck/s1600/4.png" width="400" /></a></div><div style="text-align: justify;">Click on "Format Volume". Then you will get a new dialogue box like below. Select "Encrypt underlying device" option, before clicking the "Format" button.</div><div class="separator" style="clear: both; text-align: center;"><a href="http://4.bp.blogspot.com/-qCpvAyzAiF0/UzTfB6neAFI/AAAAAAAAA9A/LTr5Tdvc0cA/s1600/5.png" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="276" src="https://4.bp.blogspot.com/-qCpvAyzAiF0/UzTfB6neAFI/AAAAAAAAA9A/LTr5Tdvc0cA/s1600/5.png" width="400" /></a></div><div class="separator" style="clear: both; text-align: center;"></div><div class="separator" style="clear: both; text-align: center;"></div><div style="text-align: justify;">After that Disk Utility will ask for a pass-phrase to encrypt the device. Give a strong pass-phrase and don't forget it! If you forget it, you will lose your all important and confidential data.</div><div style="text-align: justify;"></div><div style="text-align: justify;"></div><div class="separator" style="clear: both; text-align: center;"><a href="http://1.bp.blogspot.com/-1TJCP8ZNZIQ/UzTfGUpRo-I/AAAAAAAAA9M/waIT5fLH6pw/s1600/6.png" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="276" src="https://1.bp.blogspot.com/-1TJCP8ZNZIQ/UzTfGUpRo-I/AAAAAAAAA9M/waIT5fLH6pw/s1600/6.png" width="400" /></a></div><div style="text-align: justify;"></div><div style="text-align: justify;">Then wait till it formats the drive. This may take some time depending on your device capacity. </div><div class="separator" style="clear: both; text-align: center;"><a href="http://4.bp.blogspot.com/-owH8z1QkbfE/UzTfXbxpWBI/AAAAAAAAA9Q/ONmrXI1ZABI/s1600/7.png" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="277" src="https://4.bp.blogspot.com/-owH8z1QkbfE/UzTfXbxpWBI/AAAAAAAAA9Q/ONmrXI1ZABI/s1600/7.png" width="400" /></a></div><div style="text-align: justify;">After completing formatting you will get below the window.</div><div class="separator" style="clear: both; text-align: center;"><a href="http://3.bp.blogspot.com/-rf2oABVfXnI/UzTfc-db_iI/AAAAAAAAA9Y/vMol5PiAen8/s1600/8.png" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="277" src="https://3.bp.blogspot.com/-rf2oABVfXnI/UzTfc-db_iI/AAAAAAAAA9Y/vMol5PiAen8/s1600/8.png" width="400" /></a></div><div style="text-align: justify;">Most probably after formatting disk utility will automatically mount your disk without prompting for the password. When you are connecting encrypted disk next time, Ubuntu will prompt for the password like below</div><div class="separator" style="clear: both; text-align: center;"><a href="http://2.bp.blogspot.com/-oQ0LO9eKE7w/UzTfhbW-c_I/AAAAAAAAA9k/dlZ4eijCkXI/s1600/9.png" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="297" src="https://2.bp.blogspot.com/-oQ0LO9eKE7w/UzTfhbW-c_I/AAAAAAAAA9k/dlZ4eijCkXI/s1600/9.png" width="400" /></a></div><div style="text-align: justify;"></div><div style="text-align: justify;"></div><div class="separator" style="clear: both; text-align: center;"><a href="http://2.bp.blogspot.com/-AZ_Jr6TKDhs/UzTftil4YDI/AAAAAAAAA9o/25lpBb8i-R8/s1600/10.png" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="232" src="https://2.bp.blogspot.com/-AZ_Jr6TKDhs/UzTftil4YDI/AAAAAAAAA9o/25lpBb8i-R8/s1600/10.png" width="400" /></a></div><div style="text-align: justify;">Just type the pass-phrase and use your portable drive.</div><div class="separator" style="clear: both; text-align: center;"><a href="http://4.bp.blogspot.com/-9cVhkTxJdCo/UzTf7QnSwtI/AAAAAAAAA9w/pqTZWIPB9ck/s1600/11.png" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="250" src="https://4.bp.blogspot.com/-9cVhkTxJdCo/UzTf7QnSwtI/AAAAAAAAA9w/pqTZWIPB9ck/s1600/11.png" width="400" /></a></div><div style="text-align: justify;">But sometimes Ubuntu will prompt for the pass-phrase. When you are attempting to mount drive you will get below error.</div><pre>Unable to mount x.x GB Encrypted<br />Error unlocking device: cryptsetup exited code 5: Device &lt;UUID&gt; already exists.</pre><div class="separator" style="clear: both; text-align: center;"><a href="http://1.bp.blogspot.com/-bDXZoZCTzK0/UzTgG6PaIzI/AAAAAAAAA94/2iraFVgLe4Q/s1600/12.png" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="143" src="https://1.bp.blogspot.com/-bDXZoZCTzK0/UzTgG6PaIzI/AAAAAAAAA94/2iraFVgLe4Q/s1600/12.png" width="400" /></a></div><div style="text-align: justify;">There is a workaround for this bug. What you have to do first is closing all the applications which are using files on your encrypted device. Even the terminal windows you have to close.<br />Then run below command on a terminal.<br /><pre>sudo dmsetup remove /dev/mapper/&lt;UUID&gt;</pre>Change the UUID part according to your error message. If you are getting an error like below after running above command, please check whether there is an application which uses your encrypted device. If you have anything running please close it and run above command again!<br /><pre>device-mapper: remove ioctl failed: Device or resource busy<br />Command failed</pre></div></div>

### Tags

- Ubuntu
- linux
- ubuntu portable drive encryption
- drive encryption
